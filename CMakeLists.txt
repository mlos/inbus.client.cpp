#
# Copyright (c) 2018 Maarten Los
# See LICENSE.rst for details.
#
cmake_minimum_required (VERSION 2.6)

# Get Version
file (STRINGS VERSION.txt VERSION )

# Generate version header
set (VERSION_HEADER_FILE src/version.h)
file (WRITE ${VERSION_HEADER_FILE}  "/* Generated by CMake. DO NOT EDIT */\n")
file (APPEND ${VERSION_HEADER_FILE} "const char *inbus_client_library_version=\"Version: ${VERSION}\";\n")
project (inbusclient)

# Library build 
include_directories( thirdparty )
add_library(inbusclient src/publisher.cpp thirdparty/cpp-base64/base64.cpp)

# Distribution
set (PKG_CONFIG_FILE dist/libinbusclient.pc)
file (READ ${PKG_CONFIG_FILE}.in PKG_CONFIG)
file (WRITE ${PKG_CONFIG_FILE} "# Generated by CMake. DO NOT EDIT\n")
file (APPEND ${PKG_CONFIG_FILE} ${PKG_CONFIG})

SET_DIRECTORY_PROPERTIES(PROPERTIES ADDITIONAL_MAKE_CLEAN_FILES "${VERSION_HEADAER_FILE} ${PKG_CONFIG_FILE}")


# Installation
install (TARGETS inbusclient DESTINATION lib)
install (FILES src/publisher.h DESTINATION include/inbus)
install (FILES ${PKG_CONFIG_FILE} DESTINATION lib/pkgconfig)

# Example code build
add_executable(pub EXCLUDE_FROM_ALL examples/pub.cpp)
target_link_libraries(pub inbusclient)

add_executable(hello EXCLUDE_FROM_ALL examples/hello.cpp)
target_link_libraries(hello inbusclient)

# Distribution
set (PKG_CONFIG_FILE dist/libinbusclient.pc)
file (READ ${PKG_CONFIG_FILE}.in PKG_CONFIG)
file (WRITE ${PKG_CONFIG_FILE} "# Generated by CMake. DO NOT EDIT\n")
file (APPEND ${PKG_CONFIG_FILE} ${PKG_CONFIG})
file (APPEND ${PKG_CONFIG_FILE} "Version: ${VERSION}\n")
